import t,{useRef as e,useCallback as n}from"react";import{createPortal as r}from"react-dom";import o from"prop-types";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?h(t):e}var m=27,O=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(a,t.Component);var n,o=(n=a,function(){var t,e=p(n);if(y()){var r=p(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return v(this,t)});function a(e){var n;return i(this,a),(n=o.call(this,e)).state={active:!!e.defaultOpen},n.open=n.open.bind(h(n)),n.close=n.close.bind(h(n)),n.handleOutsideMouseClick=n.handleOutsideMouseClick.bind(h(n)),n.handleKeydown=n.handleKeydown.bind(h(n)),n.refNode=t.createRef(),n}return c(a,[{key:"componentDidMount",value:function(){this.props.closeOnEsc&&document.addEventListener("keydown",this.handleKeydown),this.props.closeOnOutsideClick&&document.addEventListener("click",this.handleOutsideMouseClick),this.props.bindTo&&(this.portalNode=document.getElementById(this.props.bindTo)),this.portalNode||(this.portalNode=document.body)}},{key:"componentWillUnmount",value:function(){this.props.closeOnEsc&&document.removeEventListener("keydown",this.handleKeydown),this.props.closeOnOutsideClick&&document.removeEventListener("click",this.handleOutsideMouseClick)}},{key:"render",value:function(){if(!this.state.active)return null;var e=t.createElement("div",{ref:this.refNode,style:this.props.style,className:this.props.className},this.props.children);return r(e,this.portalNode)}},{key:"open",value:function(t){if(!this.state.active){t&&t.nativeEvent&&t.nativeEvent.stopImmediatePropagation();var e=f({},this.state,{active:!0});this.setState(e,this.props.onOpen)}}},{key:"close",value:function(t){this.state.active&&(t&&t.nativeEvent&&t.nativeEvent.stopImmediatePropagation(),this.setState({active:!1},this.props.onClose))}},{key:"isOpen",value:function(){return this.state.active}},{key:"isOpening",value:function(){return this.state.active}},{key:"handleOutsideMouseClick",value:function(t){if(this.state.active){var e=this.refNode.current||this.portalNode;!e||e.contains(t.target)||t.button&&0!==t.button||this.close(t)}}},{key:"handleKeydown",value:function(t){t.keyCode===m&&this.state.active&&this.close(t)}}]),a}();function b(){var r=e(null),o=n((function(t){return r.current&&r.current.open(t)}),[r]),i=n((function(t){return r.current&&r.current.close(t)}),[r]),a=n((function(){return r.current&&r.current.isOpen()}),[r]),c=n((function(e){return t.createElement(O,u({ref:r},e))}),[r]);return Object.assign({},{Portal:c,isOpen:a,open:o,close:i})}
/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */
/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */
function g(t){return!0==(null!=(e=t)&&"object"==typeof e&&!1===Array.isArray(e))&&"[object Object]"===Object.prototype.toString.call(t);var e}function k(t){var e,n;return!1!==g(t)&&("function"==typeof(e=t.constructor)&&(!1!==g(n=e.prototype)&&!1!==n.hasOwnProperty("isPrototypeOf")))}O.defaultProps={onOpen:function(t){},onClose:function(t){},defaultOpen:!1,closeOnEsc:!0,closeOnOutsideClick:!0},O.propTypes={defaultOpen:o.bool,bindTo:o.string,closeOnEsc:o.bool,closeOnOutsideClick:o.bool,onOpen:o.func,onClose:o.func};var j=/[A-Z]/g,w=/^ms-/,E={};function P(t){return"-"+t.toLowerCase()}var C=function(t){return t&&Array.isArray(t)},N=function(t){return k(t)||C(t)},x=function(t,e){if(!t||t&&""===t.trim()||!k(e))return null;var n=Object.keys(e).map((function(t){return"".concat(function(t){if(E.hasOwnProperty(t))return E[t];var e=t.replace(j,P);return E[t]=w.test(e)?"-"+e:e}(t),": ").concat(e[t],";")}));return"".concat(t,"{").concat(n.join(""),"}")},M=function(t,e){var n=document.querySelector("style[".concat(t,'="').concat(e,'"]'));if(n)return n;var r=document.createElement("style");return r.type="text/css",r.setAttribute(t,e),document.head.appendChild(r),r},T=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t);var n={styleDataName:"data-keyframes"};this.keyframes={},this.options=f({},n,{},e)}return c(t,[{key:"createKeyframesString",value:function(t,e){if(!t||"string"!=typeof t||!N(e))return"";var n=C(e)?[]:{};return Object.keys(e).forEach((function(t){n[t]=e[t]})),function(t,e,n){if(!t||t&&""===t.trim()||!N(n))return null;var r=Object.keys(n).map((function(t){var e=n[t],r=t;if("number"==typeof t||/^\d+$/.test(t)){var o=n.length-1;r=0===t?"0%":t===o?"100%":"".concat(parseInt(t,10)/o*100,"%")}return x(r,e)}));return"@".concat(e," ").concat(t,"{").concat(r.join(""),"}")}(t,"keyframes",n)}},{key:"register",value:function(t,e){this.unregister(t);var n=this.options.styleDataName,r=this.createKeyframesString(t,e);if(""!==r){var o=M(n,t);null!=o&&(o.innerHTML=r,this.keyframes[t]=o)}}},{key:"unregister",value:function(t){if(this.contains(t)){var e=this.keyframes[t];e.parentNode.removeChild(e),delete this.keyframes[t]}}},{key:"unregisterAll",value:function(){var t=this;Object.keys(this.keyframes).forEach((function(e){return t.unregister(e)}))}},{key:"contains",value:function(t){return this.keyframes.hasOwnProperty(t)}}]),t}());var L=function(){var r=b(),o=r.Portal,i=r.open,a=r.close,c=r.isOpen,s=e(null),u=e(null),l=n((function(t){if(s.current){var e=s.current;return u.current=function(t,e){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),o=(n.left+n.right)/2-(r.left+r.right)/2,i=(n.top+n.bottom)/2-(r.top+r.bottom)/2;T.register("portalFadeIn",{"0%":{transform:"translate(".concat(o,"px, ").concat(i,"px) scale(0.1, 0.1) "),opacity:0},"50%":{transform:"translate(".concat(.25*o,"px, ").concat(.25*i,"px) scale(0.75, 0.75)"),opacity:.75},"100%":{opacity:1}}),T.register("portalFadeOut",{"0%":{opacity:1},"50%":{transform:"scale3d(0.5, 0.5, 0.5)",opacity:.5},"100%":{transform:"translate(".concat(o,"px, ").concat(i,"px) scale3d(0.01, 0.01, 0.01)"),opacity:0}});var a=M("data-portal-animation","portal-animation");return a&&(a.innerHTML=".portalFade {\n        animation: portalFadeIn 1s ease-out;\n    }"),function(){var t=M("data-portal-animation","portal-animation");t&&(t.innerHTML=".portalFade {\n          animation: portalFadeOut 1s ease-out;\n      }")}}(e,t.target),i(t)}return null}),[i]),f=n((function(t){if(u.current){if(u.current(),t&&t.persist&&"function"==typeof t.persist&&t.persist(),s.current){var e=s.current;e.addEventListener("animationend",(function n(){e.removeEventListener("animationend",n),a(t)}))}}else a(t)}),[a]),p=n((function(e){return e.bindTo?s.current=document.getElementById(e.bindTo):s.current=document.body,t.createElement(o,e,t.createElement("div",{tabIndex:-1,style:{position:"fixed",top:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)"},className:"portalFade"},e.children))}));return Object.assign({},{Modal:p,isOpen:c,open:l,close:f})};export default O;export{L as Modal,b as usePortal};
